<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil Comprador</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/perfil_comprador.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='imagenes/logo.drawio.png') }}" type="image/png"></head>
<body>
    <!-- Barra superior -->
    <header class="topbar">
        <div class="logo">
            <img src="{{ url_for('static', filename='imagenes/logo.drawio.png') }}" alt="Logo" class="logo-img">
        </div>
        <div class="actions">
            <a href="{{ url_for('logout') }}" class="btn logout">Cerrar Sesi√≥n</a>
        </div>
    </header>

  <!-- Modal de confirmaci√≥n para usuarios no logueados -->
  <div id="loginModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);">
    <div class="modal-content" style="background-color: #fefefe; margin: 15% auto; padding: 20px; border-radius: 10px; width: 300px; text-align: center; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
      <h3 style="margin-bottom: 15px; color: #333;">127.0.0.1:5000 dice</h3>
      <p style="margin-bottom: 20px; color: #666;">Debes iniciar sesi√≥n para agregar productos al carrito</p>
      <button id="acceptModal" style="background-color: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 14px;">Aceptar</button>
    </div>
  </div> 

  <header>
    <div class="logo">
      <img src="{{ url_for('static', filename='imagenes/logo.drawio.png') }}" alt="Logo MercadoVecino">
    </div>
    <input type="text" placeholder="Buscar productos..." class="buscador">
    <select name="filtro" id="filtro">
         <option value="">Filtrar por:</option>
        <option value="categoria">Categor√≠a</option>
        <option value="precio">Precio</option>
        <option value="fecha">M√°s recientes</option>
        <option value="disponibilidad">Disponibilidad</option>
    </select>
    <div class="acciones" id="headerActions">
      <!-- AQU√ç EST√Å EL CAMBIO PRINCIPAL -->
      {% if session.get('user_id') %}
        <!-- Usuario logueado - mostrar nombre y bot√≥n de logout -->
        <span style="color: white; margin-right: 15px;">¬°Hola, {{ session.get('user_name') }}!</span>
        <a href="{{ url_for('logout') }}" class="button-iniciar" onclick="return confirm('¬øEst√°s seguro de cerrar sesi√≥n?')">Cerrar Sesi√≥n</a>
      {% else %}
        <!-- Usuario no logueado - mostrar botones de login y registro -->
        <a href="{{ url_for('login') }}" class="button-iniciar">Iniciar Sesi√≥n</a>
        <a href="{{ url_for('registrar') }}" class="button-registrar">Registrarse</a>
      {% endif %}
    </div>
  </header>

    <main class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <ul>
                <li><a href="{{ url_for('index') }}"> üè† P√°gina Principal</a></li>
                <li><a href="#">‚≠ê Favoritos</a></li>
                <li><a href="#">üìñ Historial de Compras</a></li>
                <li><a href="{{ url_for('carrito_compras') }}">üõí Carrito de Compras</a></li>
            </ul>
        </aside>
                <li><a href="{{ url_for('carrito_compras') }}">üõí Carrito de Compras</a></li>
                <li><a href="#">‚≠ê Favoritos</a></li>
                <li><a href="#">üìñ Historial de Compras</a></li>
            </ul>
        </aside>
        

        <!-- Contenido principal -->
        <section class="profile">
            <div class="profile-header">
                <!-- Mostrar foto de perfil -->
                <img src="{{ url_for('static', filename=session.get('user_foto', 'imagenes/user.png')) }}" 
                     alt="Foto de perfil" class="profile-pic">
                <h2>Foto de Perfil</h2>
            </div>

            <form class="profile-form">
                <label>Nombre de Usuario</label>
                <input type="text" value="{{ session.get('user_name', '') }} {{ session.get('user_lastname', '') }}" readonly>
                <label>Nombres de Usuario</label>
                <input type="text" value="{{ session.get('user_name', '') }}" readonly>

                <label>Apellidos de Usuario</label>
                <input type="text" value="{{ session.get('user_lastname', '') }}" readonly>

                <label>Correo Electr√≥nico</label>
                <input type="text" value="{{ session.get('user_email', 'correo@ejemplo.com') }}" readonly>

                <label>N√∫mero de Contacto</label>
                <input type="text" value="{{ session.get('user_phone', '+57 000 000 0000') }}" readonly>

                <label>Direcci√≥n de Entrega</label>
                <input type="text" value="{{ session.get('user_address', 'No registrada') }}" readonly>
            </form>
            <br>            

            <!-- Bot√≥n para abrir modal -->
             <div class="edit-">
                <button type="button" class="edit" onclick="openModal()">Editar Perfil</button>
             </div>
            
        </section>

        <!-- Lateral derecho -->
        <aside class="help">
            <h3>¬øC√≥mo funciona?</h3>
            <p><strong>Explora el cat√°logo</strong><br>Navega por categor√≠as o usa el buscador para encontrar productos.</p>
            <p><strong>Filtra y descubre</strong><br>Ordena resultados por cercan√≠a, precio o popularidad.</p>
            <p><strong>Agrega a tu carrito o favoritos</strong><br>Guarda productos en el carrito o favoritos.</p>
            <p><strong>Recibe soporte</strong><br>Accede a la secci√≥n de ayuda si tienes dudas.</p>
        </aside>
    </main>

    <!-- Modal para editar perfil -->
<!-- Modal para editar perfil -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h3>Editar Perfil</h3>
        <form method="POST" action="{{ url_for('editar_perfil') }}" enctype="multipart/form-data">
            <label>Foto de Perfil</label>
            <input type="file" name="foto">

            <label>Nombre</label>
            <input type="text" name="nombre" value="{{ session['user_name'] }}">

            <label>Apellido</label>
            <input type="text" name="apellido" value="{{ session['user_lastname'] }}">

            <label>Correo</label>
            <input type="text" name="correo" value="{{ session.get('user_email') }}">

            <label>Tel√©fono</label>
            <input type="text" name="telefono" value="{{ session.get('user_phone') }}">

            <label>Direcci√≥n</label>
            <label>Nombres de Usuario</label>
            <input type="text" name="nombre" value="{{ session['user_name'] }}">

            <label>Apellidos de Usuario</label>
            <input type="text" name="apellido" value="{{ session['user_lastname'] }}">

            <label>Correo Electr√≥nico</label>
            <input type="text" name="correo" value="{{ session.get('user_email') }}">

            <label>N√∫mero de Contacto</label>
            <input type="text" name="telefono" value="{{ session.get('user_phone') }}">

            <label>Direcci√≥n de Entrega</label>
            <input type="text" name="direccion" value="{{ session.get('user_address') }}">

            <button type="submit" class="btn">Guardar Cambios</button>
        </form>
      </div>
    </div>

    <!-- JS para modal -->
    <script>
    function openModal() {
        document.getElementById('editModal').style.display = 'flex';
    }
    function closeModal() {
        document.getElementById('editModal').style.display = 'none';
    }
    </script>
        </section>

        <aside class="lateral-der">
      <h2>¬øC√≥mo funciona?</h2>
      <br>
      <div class="info-section">
        <h3>Explora el cat√°logo</h3>
        <p>Navega por las categor√≠as o utiliza el buscador para encontrar productos y servicios disponibles en tu zona.</p>
      </div>

      <div class="info-section">
        <h3>Filtra y descubre</h3>
        <p>Ordena los resultados seg√∫n tu preferencia: cercan√≠a, precio, popularidad o disponibilidad.</p>
      </div>

      <div class="info-section">
        <h3>Agrega a tu carrito o favoritos</h3>
        <p>Selecciona los productos que te interesen y gu√°rdalos en el carrito para comprar de inmediato o en favoritos para m√°s tarde.</p>
      </div>

      <div class="info-section">
        <h3>Recibe soporte cuando lo necesites</h3>
        <p>Si tienes dudas, accede a la secci√≥n de ayuda para recibir asistencia.</p>
      </div>
    </aside>
    </main>

      <!-- JS -->
  <script src="{{ url_for('static', filename='js/index.js') }}"></script>
  
  <!-- Funciones adicionales para navegaci√≥n -->
  <script>
    function irAPerfil() {
      const userWelcome = document.getElementById('userWelcome');
      if (!userWelcome) {
        alert('Debes iniciar sesi√≥n para acceder a tu perfil');
        window.location.href = '/login';
      } else {
        window.location.href = '/perfil_comprador';
      }
    }
    
    function irACarrito() {
      const userWelcome = document.getElementById('userWelcome');
      if (!userWelcome) {
        alert('Debes iniciar sesi√≥n para acceder al carrito');
        window.location.href = '/login';
      } else {
        window.location.href = '/carrito_compras';
      }
    }
  </script>
</body>
</html>